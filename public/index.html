<h2 class="log-title">Activity Log</h2>
<button id="download-btn">Download Logs</button>
<div id="log" class="log-box"></div>

<script>
// Load full history on page load
function loadLogHistory() {
    fetch('/logs')
        .then(r => r.json())
        .then(logs => {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = '';
            logs.reverse().forEach(l => {
                const p = document.createElement('p');
                p.textContent = new Date(l.time).toLocaleString() + " - " + l.message;
                logDiv.appendChild(p);
            });
        });
}

// Download logs as JSON
document.getElementById('download-btn').addEventListener('click', () => {
    fetch('/logs')
        .then(r => r.blob())
        .then(blob => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'logs.json';
            a.click();
            URL.revokeObjectURL(url);
        });
});

// Call load on page load
loadLogHistory();

// Live updates (existing function)
function logEvent(msg) {
    const logDiv = document.getElementById('log');
    const p = document.createElement('p');
    p.textContent = new Date().toLocaleTimeString() + " - " + msg;
    logDiv.prepend(p);
}
</script>
